{"version":3,"sources":["utils/ApiClient.js","providers/ProvideAuth.js","components/PrivateRoute.js","hooks/useInput.js","components/LoginPage.js","hooks/useCheckbox.js","components/RecoverPage.js","components/UsersList.js","components/CreateGame.js","components/GamesList.js","providers/ProvideGame.js","components/LeftTabs.js","components/Tile.js","components/Board.js","components/Captured.js","components/Table.js","components/HomePage.js","components/RegisterPage.js","App.js","index.js","utils/Chess.js"],"names":["apiRequest","endPoint","method","key","body","cb","opts","headers","JSON","stringify","url","URL","window","location","href","addr1","protocol","host","fetch","then","response","ok","contentType","get","indexOf","json","error","statusText","status","catch","message","authContext","createContext","ProvideAuth","children","auth","loadStoredUser","local","localStorage","getItem","parse","session","sessionStorage","console","log","useState","user","setUser","login","password","remember","data","setItem","removeItem","useProvideAuth","Provider","value","useAuth","useContext","PrivateRoute","rest","render","to","pathname","state","from","useInput","initialValue","ref","useRef","setValue","onChange","e","target","val","current","focus","LoginPage","setError","history","useHistory","signIn","useLocation","loginProps","loginFocus","passProps","passFocus","checked","useCheckbox","remembersProps","useEffect","replace","Card","style","width","className","Body","Title","Text","Form","Group","controlId","Label","Control","type","placeholder","Check","label","Alert","variant","Button","onClick","preventDefault","usr","RecoverPage","keyProps","keyFocus","passConfProps","passConfFocus","recoveryData","setRecoveryData","page","setPage","mail","keyLenght","id","recoveryKey","UserList","onSelect","a","list","setList","selected","setSelected","api_key","filter","u","length","ListGroup","height","map","Item","active","cursor","username","CreateGame","onNewGame","player","setPlayer","userId","GamesList","games","extSelected","g","fontWeight","opponent","whiteId","turn","blackId","gameContext","ProvideGame","game","setGame","board","setBoard","updateGame","useCallback","getBoard","pieces","updateTurn","t","useGame","LeftTabs","onGameSelected","openGamesList","setOpenGamesList","selectedGame","setSelectedGame","setKey","o","getOpenGames","Tabs","activeKey","k","Tab","eventKey","title","Tile","col","row","piece","reversed","src","myTurn","myColor","highlights","lastMov","tile","selectable","includes","black","bgColor","high","last","dest","orig","highStyle","position","backgroundSize","backgroundPosition","backgroundRepeat","backgroundImage","backgroundColor","userSelect","top","left","color","bottom","right","textAlign","1","2","3","4","5","6","7","8","margin","slice","Board","setSrc","setHigh","whitePlayerId","rows","cols","border","cellSpacing","cellPadding","r","c","inGameTiles","att","getAttacked","cast","getCastling","concat","Captured","captured","overflow","float","Table","setTurn","whitePlayerName","blackPlayerName","blackCaptured","whiteCaptured","disabled","HomePage","signout","gameSelected","socket","socketIOClient","emit","on","disconnect","Navbar","bg","expand","Brand","Toggle","Collapse","NavDropdown","alignRight","Container","fluid","Row","Col","xs","usernameProps","usernameFocus","emailProps","mailFocus","email","App","path","ReactDOM","document","getElementById","isMine","scanTileK","arr","cOrig","rOrig","cDest","rDest","newBoard","Object","keys","forEach","square","movs","attacked","parseInt","getKingSquares","push","scanRow","cdelta","rdelta","cc","rr","sortCaptures","conv","p","n","b","q","sort","na","nb","getKnightSquares","s","scanTileN","delta","module","exports","entries","maxTurn","mov","enemySquares","getAllAttackedByEnemy","rta"],"mappings":"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","file":"static/js/main.117a19d6.chunk.js","sourcesContent":["function apiRequest(endPoint, method, key, body, cb) {\r\n  let opts = { method };\r\n  if (body) {\r\n    opts = { headers: { 'Content-Type': \"application/json\" }, body: JSON.stringify(body), ...opts }\r\n  }\r\n\r\n  if (key) {\r\n    opts.headers = { 'Authorization': `Bearer ${key}`, ...opts.headers }\r\n  }\r\n  \r\n  const url = new URL(window.location.href)\r\n  const addr1 = `${url.protocol}//${url.host}/api`\r\n\r\n  const addr = process.env.NODE_ENV === 'development' ? 'http://localhost:4000/api' : addr1;\r\n  fetch(addr + endPoint, opts)\r\n    .then(response => {\r\n      if (response.ok) {\r\n        var contentType = response.headers.get(\"content-type\");\r\n        if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n          return response.json().then(function (json) {\r\n            cb(null, json)\r\n          });\r\n        } else {\r\n          cb(null, null)\r\n        }\r\n      } else {\r\n        response.json().then(json => {\r\n          cb(json.error || response.statusText || `Respuesta Inesperada ${response.status}`, null)\r\n        })\r\n      }\r\n    }).catch(error => {\r\n      cb(error.message, null)\r\n    })\r\n}\r\n\r\nexport { apiRequest }","import React, { useContext, createContext, useState } from \"react\"\r\nimport { apiRequest } from '../utils/ApiClient'\r\n\r\nconst authContext = createContext();\r\n\r\nexport function ProvideAuth({ children }) {\r\n  const auth = useProvideAuth();\r\n  return (\r\n    <authContext.Provider value={auth}>\r\n      {children}\r\n    </authContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  return useContext(authContext);\r\n}\r\n\r\nfunction useProvideAuth() {\r\n\r\n  const loadStoredUser = () => {\r\n    let local = localStorage.getItem('user');\r\n    if (local) {\r\n      return JSON.parse(local);\r\n    }\r\n    let session = sessionStorage.getItem('user');\r\n    if (session) {\r\n      return JSON.parse(session);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  console.log('useState: user');\r\n  const [user, setUser] = useState(loadStoredUser());\r\n\r\n  const signin = (login, password, remember, cb) => {\r\n    apiRequest('/v1/api_keys', 'POST', null, { login, password }, (error, data) => {\r\n      if (remember) {\r\n        localStorage.setItem('user', JSON.stringify(data))\r\n      } else {\r\n        sessionStorage.setItem('user', JSON.stringify(data))\r\n      }\r\n      setUser(data)\r\n      cb(error, data)\r\n    })\r\n  }\r\n\r\n  const signout = cb => {\r\n    setUser(null);\r\n    localStorage.removeItem('user');\r\n    sessionStorage.removeItem('user');\r\n    cb();\r\n  };\r\n  return [user, signin, signout]\r\n}","import { Route, Redirect } from 'react-router-dom'\r\nimport { useAuth } from '../providers/ProvideAuth'\r\n\r\nexport function PrivateRoute({ children, ...rest }) {\r\n    const [user] = useAuth();\r\n    return (\r\n        <Route {...rest}\r\n            render={({ location }) => {\r\n                return user ? (children) : (<Redirect\r\n                    to={{\r\n                        pathname: \"/login\",\r\n                        state: { from: location }\r\n                    }}\r\n                />)\r\n            }\r\n            }\r\n        />\r\n    );\r\n}","import { useState, useRef } from 'react'\r\n\r\nexport const useInput = (initialValue = '') => {\r\n    const ref = useRef(null)\r\n    const [value, setValue] = useState(initialValue);\r\n    return [\r\n        { value, onChange: e => setValue(e.target.value), ref },\r\n        (val = initialValue) => setValue(val),\r\n        () => ref.current && ref.current.focus()\r\n    ];\r\n}","import { useAuth } from '../providers/ProvideAuth'\r\nimport { useHistory, useLocation, Link } from 'react-router-dom'\r\nimport { useInput } from '../hooks/useInput'\r\nimport { useCheckbox } from '../hooks/useCheckbox'\r\nimport { useState, useEffect } from 'react'\r\nimport Button from 'react-bootstrap/Button';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Alert from 'react-bootstrap/Alert';\r\n\r\nexport default function LoginPage() {\r\n  const [error, setError] = useState();\r\n  const history = useHistory();\r\n  const [user, signIn] = useAuth();\r\n  const location = useLocation();\r\n\r\n  const [loginProps, , loginFocus] = useInput(\"alderick84\");\r\n\r\n  const [passProps, , passFocus] = useInput(\"123456\");\r\n  const [remembersProps] = useCheckbox(true);\r\n\r\n  const { from } = location.state || { from: { pathname: \"/\" } };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      history.replace(from);\r\n    }\r\n  }, [user, from, history])\r\n\r\n  const login = (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!loginProps.value) {\r\n      loginFocus()\r\n      setError('Debe escribir un email o nombre de usuario')\r\n    } else if (!passProps.value) {\r\n      passFocus()\r\n      setError('Debe escribir una contraseña')\r\n    } else {\r\n      signIn(loginProps.value, passProps.value, remembersProps.checked, (error, usr) => {\r\n        if (usr) {\r\n          history.replace(from);\r\n        } else {\r\n          setError(error);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card style={{ width: '36rem' }} className=\"mx-auto\">\r\n        <Card.Body>\r\n          <Card.Title>Iniciar Sesión</Card.Title>\r\n          <Card.Text>Debe indicar su nombre de usuario y contraseña, ni aún no tiene una cuenta <Link to=\"/register\">puede crearla aquí</Link>\r\n          </Card.Text>\r\n          <Form>\r\n            <Form.Group controlId=\"login\">\r\n              <Form.Label>Nombre de Usuario o Email</Form.Label>\r\n              <Form.Control type=\"text\" {...loginProps} placeholder='' />\r\n            </Form.Group>\r\n            <Form.Group controlId=\"pass\">\r\n              <Form.Label>Contraseña</Form.Label>\r\n              <Form.Control type=\"password\" {...passProps} placeholder='' />\r\n            </Form.Group>\r\n            <Form.Group controlId=\"remember\">\r\n              <Form.Check type=\"checkbox\" {...remembersProps} label=\"Recordarme en este equipo\" />\r\n            </Form.Group>\r\n            {error && <Alert variant=\"danger\">{error}</Alert>}\r\n            <p><Link to=\"/recover\">Olvidé mi usuario o contraseña</Link></p>\r\n            <Button variant=\"primary\" onClick={login}>Continuar</Button>\r\n          </Form>\r\n        </Card.Body>\r\n      </Card>\r\n    </>\r\n  );\r\n}","import { useState, useRef } from 'react'\r\n\r\nexport const useCheckbox = (initialValue = '') => {\r\n    const ref = useRef(null)\r\n    const [checked, setValue] = useState(initialValue);\r\n    return [\r\n        { checked, onChange: e => setValue(e.target.checked), ref },\r\n        (val = initialValue) => setValue(val),\r\n        () => ref.current && ref.current.focus()\r\n    ];\r\n}","import { useInput } from '../hooks/useInput'\r\nimport { useState } from 'react'\r\nimport Button from 'react-bootstrap/Button';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Alert from 'react-bootstrap/Alert';\r\nimport { apiRequest } from '../utils/ApiClient'\r\nimport { Link } from 'react-router-dom'\r\n\r\nexport default function RecoverPage() {\r\n\r\n  const [loginProps] = useInput(\"alderick84\");\r\n  const [keyProps, , keyFocus] = useInput(\"\");\r\n  const [passProps, , passFocus] = useInput(\"123456\");\r\n  const [passConfProps, , passConfFocus] = useInput(\"123456\");\r\n\r\n  const [error, setError] = useState();\r\n  const [recoveryData, setRecoveryData] = useState(null);\r\n  const [page, setPage] = useState('login');\r\n\r\n  let startRecover = (e) => {\r\n    e.preventDefault();\r\n    apiRequest('/v1/recovery_keys/', 'POST', null, { login: loginProps.value }, (error, data) => {\r\n      if (error) {\r\n        setError(error);\r\n      } else {\r\n        setRecoveryData(data);\r\n        setPage('key')\r\n      }\r\n    })\r\n  };\r\n\r\n  let sendKey = (e) => {\r\n    e.preventDefault();\r\n    if (!keyProps.value) {\r\n      keyFocus()\r\n      setError('Debe escribir una clave')\r\n    } else if (!passProps.value) {\r\n      passFocus()\r\n      setError('Debe escribir una nueva contraseña')\r\n    } else if (!passConfProps.value) {\r\n      passConfFocus()\r\n      setError('Debe escribir una confirmación de nueva contraseña')\r\n    } else if (passProps.value !== passConfProps.value) {\r\n      passConfFocus()\r\n      setError('La contraseña y su confirmación no coinciden')\r\n    } else {\r\n      apiRequest(`/v1/users/${recoveryData.id}/recovered_password`, 'PUT', null, { recoveryKey: keyProps.value, password: passProps.value }, (error, data) => {\r\n        if (error) {\r\n          setError(error);\r\n        } else {\r\n          setPage('end')\r\n        }\r\n      })\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card style={{ width: '36rem' }} className=\"mx-auto\">\r\n        <Card.Body>\r\n          <Card.Title>Recuperar Contraseña</Card.Title>\r\n          {page === 'login' &&\r\n            <>\r\n              <Card.Text>\r\n                Si olvidó su nombre de usuario o contraseña, escriba el correo o el nombre de usuario que usó para registrarse y recibirá instrucciones para recuperar su cuenta.\r\n              </Card.Text>\r\n              <Form>\r\n                <Form.Group controlId=\"login\">\r\n                  <Form.Label>Nombre de Usuario o Email</Form.Label>\r\n                  <Form.Control {...loginProps} type=\"text\" />\r\n                </Form.Group>\r\n                {error && <Alert variant=\"danger\">{error}</Alert>}\r\n                <Button variant=\"primary\" onClick={startRecover}>Recuperar</Button>\r\n              </Form>\r\n            </>\r\n          }\r\n          {page === 'key' &&\r\n            <>\r\n              <Card.Text>\r\n                A su correo {recoveryData.mail} se envió su nombre de usuario y una clave de {recoveryData.keyLenght} caracteres.\r\n              </Card.Text>\r\n              <Form>\r\n                <Form.Group controlId=\"key\">\r\n                  <Form.Label>Clave</Form.Label>\r\n                  <Form.Control {...keyProps} type=\"text\" placeholder={`Clave de ${recoveryData.keyLenght} caracteres que llegó a su correo`} />\r\n                </Form.Group>\r\n                <Form.Group controlId=\"pass\">\r\n                  <Form.Label>Nueva Contraseña</Form.Label>\r\n                  <Form.Control type=\"password\" {...passProps} placeholder='Nueva contraseña que usará para iniciar sesión' />\r\n                </Form.Group>\r\n                <Form.Group controlId=\"passConf\">\r\n                  <Form.Label>Confirmación de la Nueva Contraseña</Form.Label>\r\n                  <Form.Control type=\"password\" {...passConfProps} placeholder='Repita la nueva contraseña' />\r\n                </Form.Group>\r\n                {error && <Alert variant=\"danger\">{error}</Alert>}\r\n                <Button variant=\"primary\" onClick={sendKey}>Continuar</Button>\r\n              </Form>\r\n            </>\r\n          }\r\n          {page === 'end' &&\r\n            <>\r\n              <Card.Text>\r\n                Su contraseña se cambió con éxito, ahora puede usarla para iniciar sesión\r\n              </Card.Text>\r\n              <Link to=\"/login\"><Button variant=\"primary\">Volver al Inicio de Sesión</Button></Link>\r\n            </>\r\n          }\r\n        </Card.Body>\r\n      </Card>\r\n    </>\r\n  );\r\n}","import { useState, useEffect } from 'react'\r\nimport { apiRequest } from '../utils/ApiClient'\r\nimport { useAuth } from '../providers/ProvideAuth'\r\nimport ListGroup from 'react-bootstrap/ListGroup'\r\n\r\nexport default function UserList({ onSelect = (a) => a }) {\r\n\r\n    const [list, setList] = useState([])\r\n    const [selected, setSelected] = useState(null)\r\n    const [user] = useAuth()\r\n\r\n    useEffect(() => {\r\n        apiRequest('/v1/users?like=a', 'GET', user.api_key, null, (error, data) => {\r\n            if (!error) {\r\n                setList(data.filter((u) => u.id !== user.id))\r\n            } else {\r\n                console.log(error);\r\n            }\r\n        })\r\n    }, [user]);\r\n\r\n    if (list.length === 0) {\r\n        return <p>Cargando...</p>\r\n    }\r\n\r\n    return <ListGroup className=\"overflow-auto\" style={{height: '100px'}}>\r\n        {list && list.map((u) => <ListGroup.Item\r\n            key={u.id}\r\n            active={selected && selected.id === u.id}\r\n            onClick={() => { setSelected(u); onSelect(u) }}\r\n            style={{ cursor: 'pointer' }}\r\n        >{u.username}</ListGroup.Item>)}\r\n    </ListGroup >\r\n}","import { Alert, Button, Form } from 'react-bootstrap'\r\nimport UserList from './UsersList'\r\nimport { useState } from 'react'\r\nimport { apiRequest } from '../utils/ApiClient'\r\nimport { useAuth } from '../providers/ProvideAuth'\r\n\r\nexport default function CreateGame({ onNewGame = (a) => a }) {\r\n\r\n    const [error, setError] = useState(null)\r\n    const [player, setPlayer] = useState(null)\r\n    const [user] = useAuth()\r\n\r\n    const create = () => {\r\n        if (!player) {\r\n            setError('Seleccione un jugador')\r\n        } else {\r\n            apiRequest('/v1/games', 'post', user.api_key, { userId: player.id }, (error, data) => {\r\n                if (error) {\r\n                    setError(error)\r\n                } else {\r\n                    onNewGame(data)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    return <div className='m-3'>\r\n        <Form>\r\n            <Form.Group>\r\n                <Form.Label>Jugador</Form.Label>\r\n                <UserList onSelect={(u) => setPlayer(u)}></UserList>\r\n            </Form.Group>\r\n        </Form>\r\n        {error && <Alert variant=\"danger\">{error}</Alert>}\r\n        <Button onClick={create}>Crear Juego</Button>\r\n    </div>\r\n}","import { useState, useEffect } from 'react'\r\nimport ListGroup from 'react-bootstrap/ListGroup'\r\nimport { useAuth } from '../providers/ProvideAuth'\r\n\r\nexport default function GamesList({ onSelect = (a) => a, games, selected: extSelected }) {\r\n\r\n    const [user] = useAuth()\r\n    const [selected, setSelected] = useState(extSelected)\r\n    useEffect(() => { setSelected(extSelected) }, [extSelected])\r\n\r\n    if (!games) {\r\n        return <p>Cargando...</p>\r\n    }\r\n\r\n    if (games.length === 0) {\r\n        return <p>No hay partidas en curso</p>\r\n    }\r\n\r\n    return <ListGroup>\r\n        {games && games.map((g) =>\r\n            <ListGroup.Item\r\n                className='m-0 p-2'\r\n                key={g.id}\r\n                active={!selected ? false : selected === g.id}\r\n                onClick={() => { setSelected(g.id); onSelect(g.id) }}\r\n                style={{ cursor: 'pointer' }}>\r\n                <div style={{ fontWeight: 'bold' }}>{g.opponent}</div>\r\n                <p className='m-0 p-0'>{(g.whiteId === user.id && g.turn % 2 === 0) || (g.blackId === user.id && g.turn % 2 !== 0) ? \"Su turno\" : `Turno de ${g.opponent}`}</p>\r\n            </ListGroup.Item>)}\r\n    </ListGroup >\r\n}","import React, { useContext, createContext, useState, useCallback } from \"react\"\r\nimport { getBoard } from '../utils/Chess'\r\n\r\nconst gameContext = createContext();\r\n\r\nexport function ProvideGame({ children }) {\r\n    const [game, setGame] = useState(null)\r\n    const [board, setBoard] = useState(null)\r\n\r\n    const updateGame = useCallback((g) => {\r\n        setGame(g)\r\n        if (g) {\r\n            setBoard(getBoard(g.pieces, g.turn))\r\n        } else {\r\n            setBoard(null)\r\n        }\r\n    }, [])\r\n\r\n    const updateTurn = useCallback((t) => {\r\n        setBoard(game ? getBoard(game.pieces, t) : null)\r\n    }, [game])\r\n\r\n    const val = [game, board, updateGame, updateTurn]\r\n    return (\r\n        <gameContext.Provider value={val}>\r\n            {children}\r\n        </gameContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useGame() {\r\n    return useContext(gameContext);\r\n}\r\n\r\n","import Tabs from \"react-bootstrap/Tabs\";\r\nimport Tab from \"react-bootstrap/Tab\";\r\nimport CreateGame from \"./CreateGame\";\r\nimport GamesList from \"./GamesList\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport { useAuth } from \"../providers/ProvideAuth\";\r\nimport { apiRequest } from \"../utils/ApiClient\";\r\nimport { useGame } from \"../providers/ProvideGame\";\r\n\r\nexport default function LeftTabs({ onGameSelected = (a) => a }) {\r\n\r\n    const [game] = useGame()\r\n    const [openGamesList, setOpenGamesList] = useState([])\r\n    const [selectedGame, setSelectedGame] = useState(null)\r\n    const [user] = useAuth()\r\n\r\n    const [key, setKey] = useState('open')\r\n\r\n    useEffect(() => {\r\n        setOpenGamesList((o) => o.map(g => (\r\n            (game && (game.id === g.id)) ? { ...g, turn: game.turn } : g)\r\n        ))\r\n    }, [game])\r\n\r\n    const gameCreated = () => {\r\n        getOpenGames()\r\n        setKey(\"open\")\r\n    }\r\n\r\n    const getOpenGames = useCallback(() => {\r\n        console.log('reloading open game list');\r\n        apiRequest(`/v1/users/${user.id}/games/open`, 'GET', user.api_key, null, (error, data) => {\r\n            if (!error) {\r\n                if (data && data.length > 0) {\r\n                    setSelectedGame(data[0].id)\r\n                    onGameSelected(data[0].id)\r\n                }\r\n                setOpenGamesList(data)\r\n            } else {\r\n                console.log(error)\r\n            }\r\n        })\r\n    }, [user.id, user.api_key, onGameSelected]);\r\n\r\n    useEffect(() => {\r\n        getOpenGames();\r\n    }, [getOpenGames]);\r\n\r\n\r\n    return <Tabs\r\n        id=\"controlled-tab-example\"\r\n        activeKey={key}\r\n        onSelect={(k) => setKey(k)}>\r\n        <Tab eventKey=\"new\" title=\"Nueva Partida\">\r\n            <CreateGame onNewGame={gameCreated}></CreateGame>\r\n        </Tab>\r\n        <Tab eventKey=\"open\" title=\"Partidas\">\r\n            <GamesList games={openGamesList} selected={selectedGame} onSelect={onGameSelected} ></GamesList>\r\n        </Tab>\r\n    </Tabs>\r\n}","export function Tile({ col, row, piece = null, reversed, src, myTurn, myColor, highlights, lastMov, onSelect = a => a }) {\r\n    const tile = `${col}${row}`\r\n    const selectable = myTurn && ((piece && myColor === piece[0]) || highlights.includes(tile))\r\n    const black = col % 2 !== 0 ? row % 2 !== 0 : row % 2 === 0;\r\n    const letters = { 1: 'a', 2: 'b', 3: 'c', 4: 'd', 5: 'e', 6: 'f', 7: 'g', 8: 'h' }\r\n\r\n    const tl = {\r\n        position: \"absolute\", userSelect: 'none', width: '25px', height: '25px',\r\n        top: '0px', left: '0px',\r\n    }\r\n\r\n    const br = {\r\n        position: \"absolute\", userSelect: 'none', width: '25px', height: '25px',\r\n        bottom: '0px', right: '0px',\r\n        textAlign: 'right'\r\n    }\r\n\r\n    const onClick = () => {\r\n        if (selectable) {\r\n            onSelect();\r\n        }\r\n    }\r\n\r\n    const selected = src && src === tile\r\n    const bgColor = black ? '#b3e5fc' : '#ffffff'\r\n    const high = highlights.includes(tile)\r\n    const last = lastMov && (lastMov.dest === tile || lastMov.orig === tile)\r\n\r\n    const highStyle = high ? (piece ?\r\n        { position: \"absolute\", width: \"60px\", height: '60px', backgroundSize: '55px 55px', backgroundPosition: 'center', backgroundRepeat: 'no-repeat', backgroundImage: `url('/assets/circle.svg')` } :\r\n        { position: \"absolute\", width: \"60px\", height: '60px', backgroundSize: '15px 15px', backgroundPosition: 'center', backgroundRepeat: 'no-repeat', backgroundImage: `url('/assets/dot.svg')` })\r\n        : null\r\n\r\n    return <>\r\n        <div style={{ cursor: selectable ? 'pointer' : 'default', width: '60px', height: '60px', position: 'relative', backgroundColor: bgColor }}\r\n            onClick={onClick}>\r\n            {col === (reversed ? 8 : 1) ? <div style={{ ...tl, color: black ? '#FFFFFF' : '#b3e5fc' }}>{row}</div> : ''}\r\n            {row === (reversed ? 8 : 1) ? <div style={{ ...br, color: black ? '#FFFFFF' : '#b3e5fc' }}>{letters[col]}</div> : ''}\r\n            {selected &&\r\n                <div style={{ position: \"absolute\", width: \"60px\", height: '60px', backgroundRepeat: 'repeat', backgroundImage: `url('/assets/mask.png')` }} />\r\n            }\r\n            {last &&\r\n                <div style={{ position: \"absolute\", width: \"60px\", height: '60px', backgroundRepeat: 'repeat', backgroundImage: `url('/assets/mask.png')` }} />\r\n            }\r\n            {high && <div style={highStyle} />}\r\n            {piece &&\r\n                <div style={{ position: \"absolute\", margin: \"5px\", width: \"50px\", height: '50px', backgroundSize: '50px 50px', backgroundImage: `url('/assets/${piece.slice(0, -1)}.svg')` }}>\r\n                </div>\r\n            }\r\n            {false && <div style={{ position: \"absolute\", left: '20px', color: '#FF0000' }}>{tile}</div>}\r\n            \r\n        </div>\r\n\r\n    </>\r\n}","import { useEffect, useState } from \"react\"\r\nimport { useAuth } from \"../providers/ProvideAuth\"\r\nimport { useGame } from \"../providers/ProvideGame\"\r\nimport { apiRequest } from \"../utils/ApiClient\"\r\nimport { Tile } from \"./Tile\"\r\nimport { getAttacked, getCastling } from '../utils/Chess'\r\n\r\nexport function Board({ reversed = false }) {\r\n    const [game, board, updateGame] = useGame()\r\n    const [user] = useAuth()\r\n    const [src, setSrc] = useState(null)\r\n    const [high, setHigh] = useState([])\r\n\r\n    useEffect(() => {\r\n        setSrc(null)\r\n        setHigh([])\r\n    }, [game, board])\r\n\r\n    const myColor = user.id === game.whitePlayerId ? 'w' : 'b'\r\n    const myTurn = myColor === 'w' ? game.turn % 2 === 0 : game.turn % 2 !== 0\r\n\r\n    if (!game || !board) {\r\n        return <></>\r\n    }\r\n\r\n    const rows = reversed ? [1, 2, 3, 4, 5, 6, 7, 8] : [8, 7, 6, 5, 4, 3, 2, 1]\r\n    const cols = reversed ? [8, 7, 6, 5, 4, 3, 2, 1] : [1, 2, 3, 4, 5, 6, 7, 8]\r\n\r\n    const onSelect = (c, r) => {\r\n        const tile = `${c}${r}`\r\n        if (high.includes(tile)) {\r\n            //move\r\n            apiRequest(`/v1/games/${game.id}/moves`, 'post', user.api_key, { piece: board.inGameTiles[src].piece, src: src, dest: tile }, (error, data) => {\r\n                if (!error && data) {\r\n                    updateGame(data)\r\n                }\r\n            })\r\n            return;\r\n        }\r\n        setSrc(tile)\r\n        const att = getAttacked(board.inGameTiles, myColor, c, r)\r\n        const cast = getCastling(board.inGameTiles, myColor, c, r)\r\n        setHigh(att.concat(cast))\r\n    }\r\n\r\n    return <>\r\n        <table border='0' cellSpacing=\"0\" cellPadding=\"0\">\r\n            <tbody>{rows.map((r) =>\r\n                <tr key={r}>{\r\n                    cols.map((c) => {\r\n                        return <td key={c}>\r\n                            <Tile\r\n                                key={`${c}${r}`}\r\n                                col={c} row={r}\r\n                                piece={board.inGameTiles[`${c}${r}`] && board.inGameTiles[`${c}${r}`].piece}\r\n                                reversed={reversed}\r\n                                src={src}\r\n                                myTurn={myTurn}\r\n                                myColor={myColor}\r\n                                highlights={high}\r\n                                lastMov={board.lastMov}\r\n                                onSelect={() => onSelect(c, r)}\r\n                            >\r\n                            </Tile>\r\n                        </td>\r\n                    }\r\n                    )}\r\n                </tr>)\r\n            }\r\n            </tbody>\r\n        </table>\r\n    </>\r\n}","export function Captured({ captured }) {\r\n    return <div style={{ overflow: 'hidden', height: '30px' }}>\r\n        {captured.map(c =>\r\n            <div key={c}\r\n                style={{ width: \"30px\", height: '30px', backgroundSize: '30px 30px', float: 'left', backgroundImage: `url('/assets/${c.slice(0, -1)}.svg')` }}>\r\n            </div>\r\n        )}\r\n    </div>\r\n}","import { useAuth } from \"../providers/ProvideAuth\"\r\nimport { useGame } from \"../providers/ProvideGame\"\r\nimport { Board } from './Board'\r\nimport { Captured } from './Captured'\r\n\r\nexport function Table() {\r\n    const [user] = useAuth()\r\n    const [game, board, , setTurn] = useGame()\r\n    const reversed = game ? user.id !== game.whitePlayerId : false;\r\n    if (!game || !board) {\r\n        return <></>\r\n    }\r\n\r\n    const prev = () => {\r\n        setTurn(board.turn - 1)\r\n    }\r\n\r\n    const next = () => {\r\n        setTurn(board.turn + 1)\r\n    }\r\n\r\n    const beg = () => {\r\n        setTurn(0)\r\n    }\r\n\r\n    const end = () => {\r\n        setTurn(game.turn)\r\n    }\r\n\r\n\r\n    return <>\r\n        <div>{!reversed ? game.blackPlayerName : game.whitePlayerName}</div>\r\n        <Captured captured={reversed ? board.blackCaptured : board.whiteCaptured} />\r\n        <Board reversed={reversed} turn={game.turn}></Board>\r\n        <div>{!reversed ? game.whitePlayerName : game.blackPlayerName}</div>\r\n        <Captured captured={reversed ? board.whiteCaptured : board.blackCaptured} />\r\n\r\n        <div>\r\n            <button disabled={board.turn === 0} style={{ float: 'left' }} onClick={beg}>Beg</button>\r\n            <button disabled={board.turn === 0} style={{ float: 'left' }} onClick={prev}>Prev</button>\r\n            <div style={{ float: 'left' }}>{board.turn}</div>\r\n            <button disabled={board.turn === game.turn} style={{ float: 'left' }} onClick={next}>Next</button>\r\n            <button disabled={board.turn === game.turn} style={{ float: 'left' }} onClick={end}>End</button>\r\n        </div>\r\n    </>\r\n}","import React, { useCallback, useEffect } from 'react'\r\nimport { useAuth } from '../providers/ProvideAuth';\r\nimport LeftTabs from './LeftTabs';\r\nimport { Col, Container, Row } from 'react-bootstrap';\r\nimport Navbar from 'react-bootstrap/Navbar'\r\nimport NavDropdown from 'react-bootstrap/NavDropdown'\r\n\r\nimport { Table } from './Table';\r\nimport { useGame } from '../providers/ProvideGame'\r\nimport { apiRequest } from '../utils/ApiClient'\r\nimport socketIOClient from \"socket.io-client\";\r\n\r\nexport default function HomePage() {\r\n    const [user, , signout] = useAuth()\r\n    const [game, , updateGame] = useGame()\r\n\r\n    const gameSelected = useCallback((id) => {\r\n        apiRequest(`/v1/games/${id}`, 'get', user.api_key, null, (error, data) => {\r\n            updateGame(data)\r\n        })\r\n    }, [user.api_key, updateGame]);\r\n\r\n    useEffect(() => {\r\n        console.log('Connecting to socket.io')\r\n        const socket = process.env.NODE_ENV === 'development' ? socketIOClient(\"http://127.0.0.1:4000\") : socketIOClient()\r\n        socket.emit('link', user.id);\r\n        socket.on(\"FromAPI\", data => {\r\n            //setResponse(data);\r\n        });\r\n\r\n        socket.on('gameTurnChanged', data => {\r\n            if (game) {\r\n                gameSelected(game.id)\r\n            }\r\n        })\r\n\r\n        return () => {\r\n            console.log('disconnecting from socket.io')\r\n            socket.disconnect()\r\n        }\r\n        //\r\n    }, [user.id, game, gameSelected]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    const logout = (e) => {\r\n        e.preventDefault()\r\n        signout(() => { })\r\n    }\r\n\r\n    return <>\r\n        <Navbar bg=\"light\" expand=\"lg\">\r\n            <Navbar.Brand>JSChess</Navbar.Brand>\r\n            <Navbar.Toggle />\r\n            <Navbar.Collapse className=\"justify-content-end mr-auto\">\r\n                <NavDropdown title={user.username} id=\"basic-nav-dropdown\" alignRight>\r\n                    <NavDropdown.Item onClick={logout}>Salir</NavDropdown.Item>\r\n                </NavDropdown>\r\n            </Navbar.Collapse>\r\n        </Navbar>\r\n        <Container fluid>\r\n            <Row>\r\n                <Col xs={3} className='m-0 p-0'><LeftTabs onGameSelected={gameSelected} ></LeftTabs></Col>\r\n                <Col xs={6} className='m-0 p-0'><Table></Table></Col>\r\n            </Row>\r\n        </Container>\r\n    </>\r\n}","import { useInput } from '../hooks/useInput'\r\nimport { useState } from 'react'\r\nimport Button from 'react-bootstrap/Button';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Alert from 'react-bootstrap/Alert';\r\nimport { apiRequest } from '../utils/ApiClient'\r\nimport { Link } from 'react-router-dom'\r\n\r\nexport default function RecoverPage() {\r\n\r\n  const [usernameProps, , usernameFocus] = useInput(\"chiquimarzo\");\r\n  const [emailProps, , mailFocus] = useInput(\"chiquimarzo@gmail.com\");\r\n  const [passProps, , passFocus] = useInput(\"123456\");\r\n  const [passConfProps, , passConfFocus] = useInput(\"123456\");\r\n\r\n  const [error, setError] = useState();\r\n  const [page, setPage] = useState('create');\r\n  \r\n  let register = (e) => {\r\n    e.preventDefault();\r\n    if (!usernameProps.value) {\r\n      usernameFocus()\r\n      setError('Debe escribir un nombre de usuario')\r\n    } else if (!emailProps.value) {\r\n      mailFocus()\r\n      setError('Debe escribir un correo')\r\n    } else if (!passProps.value) {\r\n      passFocus()\r\n      setError('Debe escribir una contraseña')\r\n    } else if (!passConfProps.value) {\r\n      passConfFocus()\r\n      setError('Debe escribir una confirmación de contraseña')\r\n    } else if (passProps.value !== passConfProps.value) {\r\n      passConfFocus()\r\n      setError('La contraseña y su confirmación no coinciden')\r\n    } else {\r\n      apiRequest(`/v1/users/`, 'POST', null, { username: usernameProps.value, email: emailProps.value, password: passProps.value }, (error, data) => {\r\n        if (error) {\r\n          setError(error);\r\n        } else {\r\n          setPage('created')\r\n        }\r\n      })\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card style={{ width: '36rem' }} className=\"mx-auto\">\r\n        <Card.Body>\r\n          <Card.Title>Registrarse</Card.Title>\r\n          {page === 'create' &&\r\n            <>\r\n              <Card.Text>\r\n                Puede crear una cuenta únicamente con los siguientes datos:\r\n              </Card.Text>\r\n              <Form>\r\n                <Form.Group>\r\n                  <Form.Label>Nombre de Usuario</Form.Label>\r\n                  <Form.Control type=\"text\" {...usernameProps} />\r\n                </Form.Group>\r\n                <Form.Group>\r\n                  <Form.Label>Email</Form.Label>\r\n                  <Form.Control type=\"email\" {...emailProps} placeholder={`Para recuperar su cuenta si tiene olvida su contraseña`} />\r\n                </Form.Group>\r\n                <Form.Group>\r\n                  <Form.Label>Contraseña</Form.Label>\r\n                  <Form.Control type=\"password\" {...passProps} placeholder='Contraseña que usará para iniciar sesión' />\r\n                </Form.Group>\r\n                <Form.Group>\r\n                  <Form.Label>Confirmación de la Contraseña</Form.Label>\r\n                  <Form.Control type=\"password\" {...passConfProps} placeholder='Repita la contraseña' />\r\n                </Form.Group>\r\n                {error && <Alert variant=\"danger\">{error}</Alert>}\r\n                <Button variant=\"primary\" onClick={register}>Crear Cuenta</Button>\r\n              </Form>\r\n            </>\r\n          }\r\n          {page === 'created' &&\r\n            <>\r\n              <Card.Text>\r\n                {usernameProps.value} su cuenta se creó con éxito, ahora puede iniciar sesión con los datos que suministró\r\n              </Card.Text>\r\n              <Link to=\"/login\"><Button variant=\"primary\">Ir al Inicio de Sesión</Button></Link>\r\n            </>\r\n          }\r\n        </Card.Body>\r\n      </Card>\r\n    </>\r\n  );\r\n}","import { Route, Switch } from 'react-router';\nimport { PrivateRoute } from './components/PrivateRoute';\nimport LoginPage from './components/LoginPage'\nimport RecoverPage from './components/RecoverPage'\nimport HomePage from './components/HomePage'\nimport RegisterPage from './components/RegisterPage'\nimport { BrowserRouter as Router } from 'react-router-dom'\nimport { ProvideAuth } from './providers/ProvideAuth'\nimport { ProvideGame } from './providers/ProvideGame'\n\nfunction App() {\n\n  return (\n    <ProvideAuth>\n      <Router>\n        <Switch>\n          <Route path=\"/recover\">\n            <RecoverPage />\n          </Route>\n          <Route path=\"/login\">\n            <LoginPage />\n          </Route>\n          <Route path=\"/register\">\n            <RegisterPage />\n          </Route>\n          <PrivateRoute path=\"/secret\">\n            <h1>Secret</h1>\n          </PrivateRoute>\n          <PrivateRoute path=\"/\">\n            <ProvideGame>\n              <HomePage />\n            </ProvideGame>\n          </PrivateRoute>\n        </Switch>\n      </Router>\n    </ProvideAuth>\n  );\n}\n\nexport default App;\n","/**\n  This CodeSandbox has been automatically generated using\n  `codesandboxer`. If you're curious how that happened, you can\n  check out our docs here: https://github.com/codesandbox/codesandboxer\n\n  If you experience any struggles with this sandbox, please raise an issue\n  on github. :)\n*/\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n//import App from './example';\nimport App from './App';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n","const isMine = (myColor, piece) => {\r\n    return (myColor === piece[0])\r\n}\r\n\r\nconst scanTileK = (arr, board, myColor, cOrig, rOrig, cDest, rDest) => {\r\n    if (cDest >= 1 && cDest <= 8 && rDest >= 1 && rDest <= 8) {\r\n        const dest = `${cDest}${rDest}`;\r\n        const orig = `${cOrig}${rOrig}`;\r\n\r\n        if (!board[dest] || !isMine(myColor, board[dest].piece)) {\r\n            const newBoard = []\r\n            Object.keys(board).forEach((square) => {\r\n                if (square !== orig && square !== dest) {\r\n                    newBoard[square] = board[square]\r\n                }\r\n            })\r\n            newBoard[dest] = { piece: board[orig].piece, movs: board[orig].movs + 1 }\r\n\r\n            let attacked = false\r\n            for (const square of Object.keys(newBoard)) {\r\n                const piece = newBoard[square].piece\r\n                if (piece[0] !== myColor) {\r\n                    if (piece[1] !== 'k') {\r\n                        if (getAttacked(newBoard, piece[0], parseInt(square[0]), parseInt(square[1])).includes(dest)) {\r\n                            attacked = true\r\n                            break\r\n                        }\r\n                    } else {\r\n                        //TODO, Si una de estas casillas estuviera bajo ataque de una pieza de mi color, si podría ir allá\r\n                        if (getKingSquares(parseInt(square[0]), parseInt(square[1])).map(a => `${a[0]}${a[1]}`).includes(dest)) {\r\n                            attacked = true\r\n                            break\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (!attacked) {\r\n                arr.push(dest)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst scanTileN = (arr, board, myColor, cDest, rDest) => {\r\n    if (cDest >= 1 && cDest <= 8 && rDest >= 1 && rDest <= 8) {\r\n        const tile = `${cDest}${rDest}`;\r\n        if (board[tile]) {\r\n            if (!isMine(myColor, board[tile].piece)) {\r\n                arr.push(tile)\r\n            }\r\n        } else {\r\n            arr.push(tile)\r\n        }\r\n    }\r\n}\r\n\r\nconst scanRow = (arr, board, myColor, c, r, cdelta, rdelta) => {\r\n    for (let cc = c + cdelta, rr = r + rdelta; cc >= 1 && cc <= 8 && rr >= 1 && rr <= 8; cc += cdelta, rr += rdelta) {\r\n        const tile = `${cc}${rr}`;\r\n        const piece = board[tile];\r\n        if (piece) {\r\n            if (!isMine(myColor, piece.piece)) {\r\n                arr.push(tile)\r\n            }\r\n            break\r\n        } else {\r\n            arr.push(tile)\r\n        }\r\n    }\r\n}\r\n\r\nconst getBoard = (pieces, turn) => {\r\n    const inGameTiles = []\r\n    const whiteCaptured = []\r\n    const blackCaptured = []\r\n    let lastMov\r\n    Object.entries(pieces).forEach(p => {\r\n        const movs = Object.keys(p[1]).map(s => parseInt(s)).sort((a, b) => a - b).filter(c => c <= turn)\r\n        const maxTurn = movs[movs.length - 1];\r\n        if (p[1][maxTurn] === 'c') {\r\n            if (p[0].slice(0, 1) === 'w') {\r\n                whiteCaptured.push(p[0])\r\n            } else {\r\n                blackCaptured.push(p[0])\r\n            }\r\n        } else {\r\n            inGameTiles[p[1][maxTurn]] = { piece: p[0], movs: movs.length, maxTurn }\r\n            if (maxTurn === turn && turn > 0) {\r\n                const mov = {\r\n                    piece: p[0],\r\n                    orig: p[1][movs[movs.length - 2]],\r\n                    dest: p[1][movs[movs.length - 1]]\r\n                }\r\n\r\n                if (!lastMov || lastMov.piece.slice(1, 2) === 'r') {\r\n                    lastMov = mov\r\n                }\r\n            }\r\n        }\r\n    })\r\n    return { inGameTiles, whiteCaptured: sortCaptures(whiteCaptured), blackCaptured: sortCaptures(blackCaptured), lastMov, turn }\r\n}\r\n\r\nconst sortCaptures = (list) => {\r\n    const conv = { p: 0, n: 1, b: 2, r: 3, q: 4 }\r\n    return list.sort((a, b) => {\r\n        const na = conv[a.slice(1, 2)], nb = conv[b.slice(1, 2)]\r\n        return (na > nb ? 1 : (na < nb ? -1 : 0))\r\n    })\r\n}\r\n\r\nconst getKingSquares = (c, r) => {\r\n    return [[c, r + 1], [c + 1, r + 1], [c + 1, r], [c + 1, r - 1], [c, r - 1], [c - 1, r - 1], [c - 1, r], [c - 1, r + 1]]\r\n}\r\n\r\nconst getKnightSquares = (c, r) => {\r\n    return [[c + 1, r + 2], [c + 2, r + 1], [c + 2, r - 1], [c + 1, r - 2], [c - 1, r - 2], [c - 2, r - 1], [c - 2, r + 1], [c - 1, r + 2]]\r\n}\r\n\r\nconst getAllAttackedByEnemy = (board, myColor) => {\r\n    const enemySquares = Object.keys(board).filter(s => board[s] && board[s].piece.slice(0, 1) !== myColor)\r\n    let attacked = []\r\n    enemySquares.forEach(s => {\r\n        attacked = attacked.concat(getAttacked(board, myColor === 'w' ? 'b' : 'w', parseInt(s.slice(0, 1)), parseInt(s.slice(1, 2))))\r\n    })\r\n    return attacked\r\n}\r\n\r\n\r\nconst getCastling = (board, myColor, c, r) => {\r\n    const attacked = getAllAttackedByEnemy(board, myColor)\r\n    const rta = []\r\n    if (board[`${c}${r}`] && (board[`${c}${r}`].piece.slice(1, 2) === 'k' && board[`${c}${r}`].movs === 1)) {\r\n        if (!attacked.includes(`${c}${r}`)) {\r\n            //long castling\r\n            if (board[`1${r}`] && (board[`1${r}`].piece.slice(1, 2) === 'r' && board[`1${r}`].movs === 1)) {\r\n                if (!board[`4${r}`] && !board[`3${r}`] && !board[`2${r}`]) {\r\n                    if (!attacked.includes(`4${r}`) && !attacked.includes(`3${r}`)) {\r\n                        rta.push(`${c - 2}${r}`)\r\n                    }\r\n                }\r\n            }\r\n            //short\r\n            if (board[`8${r}`] && (board[`8${r}`].piece.slice(1, 2) === 'r' && board[`8${r}`].movs === 1)) {\r\n                if (!board[`6${r}`] && !board[`7${r}`]) {\r\n                    if (!attacked.includes(`6${r}`) && !attacked.includes(`7${r}`)) {\r\n                        rta.push(`${c + 2}${r}`)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return rta\r\n}\r\n\r\n\r\n/*list of squares attacked from the square c, r */\r\nconst getAttacked = (board, myColor, c, r) => {\r\n    const arr = []\r\n    const tile = `${c}${r}`\r\n    const piece = board[tile].piece\r\n    const type = piece.slice(1, -1)\r\n    const color = piece.slice(0, 1)\r\n\r\n    if (type === 'k') {\r\n        //TODO king must not be left on a position where it's under attack\r\n        //TODO castling\r\n        getKingSquares(c, r).forEach(a => scanTileK(arr, board, myColor, c, r, a[0], a[1]))\r\n    } else if (type === 'r') {\r\n        scanRow(arr, board, myColor, c, r, 0, 1)\r\n        scanRow(arr, board, myColor, c, r, 0, -1)\r\n        scanRow(arr, board, myColor, c, r, 1, 0)\r\n        scanRow(arr, board, myColor, c, r, -1, 0)\r\n    } else if (type === 'n') {\r\n        getKnightSquares(c, r).forEach(s => scanTileN(arr, board, myColor, s[0], s[1]))\r\n    } else if (type === 'b') {\r\n        scanRow(arr, board, myColor, c, r, 1, 1)\r\n        scanRow(arr, board, myColor, c, r, 1, -1)\r\n        scanRow(arr, board, myColor, c, r, -1, 1)\r\n        scanRow(arr, board, myColor, c, r, -1, -1)\r\n    } else if (type === 'q') {\r\n        scanRow(arr, board, myColor, c, r, 1, 1)\r\n        scanRow(arr, board, myColor, c, r, 1, -1)\r\n        scanRow(arr, board, myColor, c, r, -1, 1)\r\n        scanRow(arr, board, myColor, c, r, -1, -1)\r\n        scanRow(arr, board, myColor, c, r, 0, 1)\r\n        scanRow(arr, board, myColor, c, r, 0, -1)\r\n        scanRow(arr, board, myColor, c, r, 1, 0)\r\n        scanRow(arr, board, myColor, c, r, -1, 0)\r\n    } else if (type === 'p') {\r\n        const delta = color === 'w' ? 1 : -1\r\n        //first square\r\n        if (!board[`${c}${r + delta}`]) {\r\n            arr.push(`${c}${r + delta}`)\r\n            //second square\r\n            if (board[tile].movs === 1 && !board[`${c}${r + delta + delta}`]) {\r\n                arr.push(`${c}${r + delta + delta}`)\r\n            }\r\n        }\r\n        //attacks\r\n        if (board[`${c + 1}${r + delta}`]) {\r\n            if (myColor !== board[`${c + 1}${r + delta}`].piece.slice(0, 1)) {\r\n                arr.push(`${c + 1}${r + delta}`)\r\n            }\r\n        }\r\n        if (board[`${c - 1}${r + delta}`]) {\r\n            if (myColor !== board[`${c - 1}${r + delta}`].piece.slice(0, 1)) {\r\n                arr.push(`${c - 1}${r + delta}`)\r\n            }\r\n        }\r\n    }\r\n    return arr\r\n}\r\n\r\nmodule.exports = { getBoard, getAttacked, getCastling }"],"sourceRoot":""}